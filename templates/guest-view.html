<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Bootstrap demo</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
</head>

<style>
  html,
  body {
    height: 100%;
    overflow-x: hidden;
    margin: 0px;
  }
</style>

<body>



  <div class="row h-100 p-2 align-items-center">
    <div class="col text-center align-middle">
      <img src="../static/logo-placeholder.jpg" class="img-fluid" alt="...">
    </div>
    <!-- <div class="col-auto align-items-stretch m-2" >
     
        <div class="vr vh-100 "></div>
     
    </div> -->
    <div class="col text-center align-middle">
      <h1>Please Scan your QR Code</h1>
      <p>Or</p>
      <button type="button" class="btn btn-danger btn-lg" data-bs-toggle="modal" data-bs-target="#registerModal">Sign
        Up</button>
    </div>
  </div>



  <div class="position-fixed bottom-0 start-50 translate-middle-x p-3" style="z-index: 11">
    <div id="infoToast" class="toast" role="alert" aria-live="assertive" aria-atomic="true">
      <div class="toast-header">
        <strong class="me-auto fs-2">Guest Signed IN</strong>
      </div>
      <div class="toast-body fs-2" id="infoToastBody">
        Welcome Guest!
      </div>
    </div>
  </div>

  <!-- Modal -->
  <div class="modal fade " id="registerModal" tabindex="-1" data-bs-backdrop="static"
    aria-labelledby="registerModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-centered modal-dialog-scrollable">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="exampleModalLabel">New Guest Registration</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">

          <form class="row g-3" method="post">

            <div class="col-md-6">
              <label for="fetUsername" class="form-label">Fet/Fetlife Username</label>
              <div class="input-group">
                <span class="input-group-text" id="fetUsernamePrepend">@</span>
                <input type="text" class="form-control" name="fetUsername" id="fetUsername">
              </div>
            </div>

            <div class="col-md-6">
              <label for="firstName" class="form-label">First name</label>
              <input type="text" class="form-control" name="firstName" id="firstName" required>
            </div>
            <div class="col-md-6">
              <label for="lastName" class="form-label">Last name</label>
              <input type="text" class="form-control" name="lastName" id="lastName" required>
            </div>

            <div class="col-md-6">
              <label for="emailAddress" class="form-label">Email address</label>
              <input type="email" class="form-control" name="emailAddress" id="emailAddress"
                placeholder="name@example.com" required>
            </div>
            <div class="col-md-6">
              <label for="phoneNumber" class="form-label">Phone #</label>
              <input type="tel" class="form-control" name="phoneNumber" id="phoneNumber" placeholder="301-000-0000">
            </div>
            <div class="col-12">
              <div class="form-check">
                <input class="form-check-input" type="checkbox" value="false" name="termsCheck" id="termsCheck" >
                <label class="form-check-label" for="termsCheck">
                  Agree to Terms and Conditions <button class="btn btn-outline-primary" data-bs-target="#tosModal" data-bs-toggle="modal" data-bs-dismiss="modal">Current Terms and Conditions</button>
                </label>
              </div>
            </div>
            <div class="col-12">
              <div class="form-check">
                <input class="form-check-input" type="checkbox" value="false" name="idCheck" id="idCheck" >
                <label class="form-check-label" for="idCheck">
                  Agree to ID Photocopy
                </label>
              </div>
            </div>
            <div class="col-12">
              <button class="btn btn-primary" type="submit">Submit form</button>
            </div>
          </form>

        </div>
      </div>
    </div>
  </div>


  <div class="modal fade" id="tosModal" aria-hidden="true" tabindex="-1" data-bs-backdrop="static">
    <div class="modal-dialog modal-lg modal-dialog-centered modal-dialog-scrollable">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="exampleModalToggleLabel2">Terms and Conditions</h5>
        </div>
        <div class="modal-body">
          Hide this modal and show the first with the button below.
        </div>
        <div class="modal-footer">
          <button class="btn btn-primary" data-bs-target="#registerModal" data-bs-toggle="modal" data-bs-dismiss="modal">Return</button>
        </div>
      </div>
    </div>
  </div>


  <!-- 
  <div">

    <div class="d-flex flex-row justify-content-center align-items-stretch">
      <div class="bd-highlight align-self-center flex-fill text-center">
        
      </div>
      <div class="bd-highlight">
        
      </div>
      <div class="bd-highlight align-self-center flex-fill text-center">
        {% if guid %}
        Hello {{ guid }}!
        {% else %}
        Hello, World!
        {% endif %}
      </div>
    </div>

  </div> -->







  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
    crossorigin="anonymous"></script>


  <script>

    var qrCodeInput = "";
    var allowQrCodeInput = true;

    var myToastEl = document.getElementById('infoToast')
    var myToastElBody = document.getElementById('infoToastBody')
    var myToast = bootstrap.Toast.getOrCreateInstance(myToastEl) // Returns a Bootstrap toast instance


    function SubmitQrCode() {
      if (qrCodeInput) {
        //qrCodeInput = qrCodeInput.replace(/[^a-zA-Z0-9]/g, '');
        //qrCodeInput = qrCodeInput.replace(/[^\w\s]/gi, '');
        //qrCodeInput = qrCodeInput.replace(/[^ -~]+/g, "");
 


        console.log("Fetching", 'http://127.0.0.1:5000/checkIn/' + encodeURI(qrCodeInput))

        fetch('http://127.0.0.1:5000/checkIn/' + encodeURI(qrCodeInput))
          .then(response => {
            if (!response.ok) {
              throw new Error('Network response was not ok');
            }
            return response.json();
          })
          .then(data => {
            console.log('Data received:', data);
            myToastElBody.innerText = 'Welcome ' + data
            myToast.show()
          })
          .catch(error => {
            console.error('There was a problem with the fetch operation:', error);
          });



        //alert('QR Code Submitted');
      } else {
        //alert('Error');
      }
      qrCodeInput = "";
    }

    var qrCodeInputTimer = null;



    document.onkeyup = function (e) {
      if (allowQrCodeInput) {
        clearTimeout(qrCodeInputTimer);
        qrCodeInputTimer = setTimeout(SubmitQrCode, 1000);
        if (e.key != 'Enter') {
          qrCodeInput += `${e.key}`; //String.fromCharCode(e.keyCode || e.which);          
        }else{
          clearTimeout(qrCodeInputTimer);
          SubmitQrCode();
        }
      }
    };


    var myModalEl = document.getElementById('registerModal')
    myModalEl.addEventListener('show.bs.modal', function (event) {
      allowQrCodeInput = false; // Disable QrCodeInput
    })
    myModalEl.addEventListener('hidden.bs.modal', function (event) {
      allowQrCodeInput = true; // Allow QrCodeInput
      qrCodeInput = "";
    })



  </script>
</body>

</html>